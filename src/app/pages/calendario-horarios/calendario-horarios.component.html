<div class="container mt-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="bi bi-calendar-week me-2"></i>Mi Horario
    </h2>
    
    <div class="btn-group" role="group">
      <button class="btn btn-outline-primary" 
              [class.active]="tipoVista === 'calendario'"
              (click)="cambiarVista('calendario')">
        <i class="bi bi-calendar"></i> Calendario
      </button>
      <button class="btn btn-outline-primary" 
              [class.active]="tipoVista === 'lista'"
              (click)="cambiarVista('lista')">
        <i class="bi bi-list"></i> Lista
      </button>
    </div>
  </div>
  
  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando horarios...</p>
  </div>
  
  <!-- Vista Calendario -->
  <div *ngIf="!isLoading && tipoVista === 'calendario'">
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-bordered mb-0">
            <thead class="table-light">
              <tr>
                <th width="10%" class="text-center">Hora</th>
                <th *ngFor="let dia of diasSemana" width="15%" class="text-center">
                  {{ dia }}
                </th>
              </tr>
            </thead>
            <tbody>
              <!-- Solo mostrar horas de 7:00 a 19:00 -->
              <tr *ngFor="let hora of horasDia; let i = index">
                <td class="text-center align-middle bg-light">
                  <small class="fw-medium">{{ hora }}</small>
                  <br>
                  <small class="text-muted">{{ i + 7 }}:00-{{ i + 8 }}:00</small>
                </td>
                
                <td *ngFor="let dia of diasSemana" 
                    class="position-relative" 
                    style="height: 60px; min-height: 60px;">
                  
                  <!-- Celda vacía por defecto -->
                  <div class="h-100 w-100 position-relative">
                    
                    <!-- Horarios que comienzan en esta hora -->
                    <div *ngFor="let horario of getHorariosEnHora(dia, hora)" 
                        class="position-absolute rounded p-2 text-white"
                        [style]="calcularEstiloHorario(horario)"
                        [style.left.px]="1"
                        [style.right.px]="1"
                        [title]="getTooltipHorario(horario)">
                      
                      <div class="small">
                        <div class="fw-medium">{{ horario.cursoNombre }}</div>
                        <div class="small">
                          {{ horario.seccionCodigo }} • {{ horario.aula }}
                        </div>
                        <div class="small opacity-75">
                          {{ getFormatoHora(horario.horaInicio) }}-{{ getFormatoHora(horario.horaFin) }}
                        </div>
                      </div>
                    </div>
                    
                    <!-- Indicador si no hay horarios -->
                    <div *ngIf="getHorariosEnHora(dia, hora).length === 0" 
                        class="h-100 d-flex align-items-center justify-content-center">
                      <small class="text-muted">-</small>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Leyenda -->
    <div class="mt-3">
      <div class="row">
        <div *ngFor="let horario of horarios | slice:0:5" class="col-auto mb-2">
          <div class="d-flex align-items-center">
            <div class="color-indicator me-2" 
                 [style.background-color]="horario.color"
                 style="width: 20px; height: 20px; border-radius: 4px;"></div>
            <small>{{ horario.cursoNombre }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Vista Lista -->
  <div *ngIf="!isLoading && tipoVista === 'lista'">
    <div class="row">
      <div *ngFor="let dia of diasSemana" class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header bg-light">
            <h6 class="mb-0">{{ dia }}</h6>
          </div>
          <div class="card-body">
            <div *ngIf="(horariosAgrupados.get(dia) || []).length === 0" class="text-center text-muted py-3">
              <i class="bi bi-calendar-x display-6 d-block mb-2"></i>
              Sin horarios
            </div>
            
            <div *ngFor="let horario of horariosAgrupados.get(dia) || []" class="mb-3">
              <div class="d-flex">
                <div class="color-indicator me-3" 
                     [style.background-color]="horario.color"
                     style="width: 8px; border-radius: 4px;"></div>
                <div class="flex-grow-1">
                  <div class="d-flex justify-content-between">
                    <h6 class="mb-1">{{ horario.cursoNombre }}</h6>
                    <!--<span class="badge" [ngClass]="{
                      'bg-primary': horario.tipoUsuario === 'ROL_ESTUDIANTE',
                      'bg-success': horario.tipoUsuario === 'ROL_DOCENTE'
                    }">
                      {{ horario.tipoUsuario }}
                     </span>-->
                  </div>
                  <div class="mb-1">
                    <span class="badge bg-info">{{ horario.seccionCodigo }}</span>
                    <span class="badge bg-secondary ms-1">{{ horario.aula }}</span>
                  </div>
                  <div class="text-muted small">
                    <i class="bi bi-clock me-1"></i>
                    {{ getFormatoHora(horario.horaInicio) }} - {{ getFormatoHora(horario.horaFin) }}
                    ({{ getDuracion(horario) }})
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Sin horarios -->
  <div *ngIf="!isLoading && horarios.length === 0" class="text-center py-5">
    <i class="bi bi-calendar-x display-1 text-muted d-block mb-3"></i>
    <h4 class="text-muted">No hay horarios asignados</h4>
    <p class="text-muted">No tienes horarios programados para este período.</p>
  </div>
</div>